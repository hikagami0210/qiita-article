---
title: ã€Reactã€‘SWRã‚’ä¾¿åˆ©ã«æ‰±ã†è‡ªä½œãƒ¡ã‚½ãƒƒãƒ‰
tags:
  - React
  - SWR
private: false
updated_at: '2024-02-11T22:47:35+09:00'
id: 95be8a6e01c1e4bf739c
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«
ä»Šå›ã¯ã€Reactã§APIã®fetchã‚’ç°¡å˜ã«è¡Œãˆã‚‹[SWR](https://swr.vercel.app/ja)ã‚’ã€ã‚‚ã†ã¡ã‚‡ã£ã¨ä¾¿åˆ©ã«æ‰±ã†è‡ªä½œãƒ¡ã‚½ãƒƒãƒ‰ç­‰ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

ã€Œã‚‚ã£ã¨ã“ã‚“ãªã‚„ã‚Šæ–¹ãŒã‚ã‚‹ã‚ˆï¼ã€ç­‰ã®æ„è¦‹ãŒã‚ã‚Šã¾ã—ãŸã‚‰æ˜¯éã‚³ãƒ¡ãƒ³ãƒˆã«ãŠé¡˜ã„ã—ã¾ã™!ğŸ™‡ğŸ»â€â™‚ï¸ğŸ™‡ğŸ»â€â™‚ï¸

## æœ¬é¡Œ
ã‚‚ã£ã¨ã‚‚åŸºç¤çš„ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ãª`SWR`ã®ä½¿ã„æ–¹ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®profileãƒ‡ãƒ¼ã‚¿ã‚’apiã‹ã‚‰fetchã—ã¦ãã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã™ã€‚

```tsx
const useProfile = () => {
    const headers = {
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`,
    };
    const url = `${API_URL}/profile`;

    const fetcher = async () => {
        return axios.get(url, { headers }).then((response) => {
            return response.data;
        });
    };

    const { data, error, isLoading } = useSWR<Profile>(url, fetcher);

    return { data, error, isLoading };
};
```

ã“ã‚Œã§ã‚‚ååˆ†ã«ã‚·ãƒ³ãƒ—ãƒ«ã ã¨ã¯æ€ã„ã¾ã™ãŒã€`headers`ã‚„`fetcher`ã«é–¢ã—ã¦ã¯ä½¿ã„å›ã—ãŒã‹ãªã‚ŠåŠ¹ãã®ã§åˆ‡ã‚Šå‡ºã—ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ã€‚

ä¾‹ãˆã°ä»¥ä¸‹ã¯ãã‚Œã‚‰ã‚’åˆ‡ã‚Šå‡ºã—ã¦ã¿ãŸä¾‹ã§ã™ã€‚

```ts
const swrFetcher = async (url: string) => {
    const headers = {
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`,
    };

    const response = await axios.get(url, { headers });
    return response.data;
};

const useProfile = () => {
    const url = `${API_URL}/profile`;

    const { data, error, isLoading } = useSWR<Profile>(url, swrFetcher);

    return { data, error, isLoading };
};
```

ã“ã†ã—ã¦ãŠã‘ã°ã€ä»–ã®ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹æ™‚ã«`swrFetcher`ã‚’importã—ã¦ä½¿ç”¨ã™ã‚‹ã ã‘ãªã®ã§ã€æ›¸ãã®ãŒå¤šå°‘æ¥½ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€`SWR`ã«ã¯ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç­‰ã‚’åˆ¶å¾¡ã§ãã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã¯ã€"åˆå›ã®fetchä»¥é™ã€ãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã„ç¶šã‘ã‚‹"ã¨ã„ã†optionã‚’ä»˜ä¸ã—ãŸ`useSWR`ã§ã™ã€‚
(`useSWRImmutable`ã¨ã„ã†åŒç­‰ã®æ©Ÿèƒ½ã‚’æŒã¤ãƒ•ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ãŒã€èª¬æ˜ã®ãŸã‚`useSWR`ã‚’ä½¿ç”¨ã—ã¾ã™)

```ts
const useProfile = () => {
    const url = `${API_URL}/profile`;

    const { data, error, isLoading } = useSWR<Profile>(
        url,
        swrFetcher,
        {
            revalidateIfStale: false,
            revalidateOnFocus: false,
            revalidateOnReconnect: false,
        }
    );

    return { data, error, isLoading };
};
```

ã“ã®æ™‚ç¬¬ä¸‰å¼•æ•°éƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã—ã¦ãŠãã¨ã€ã‚³ãƒ¼ãƒ‰ãŒç°¡æ½”ã«ãªã‚ŠåŒã˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»–ã§ä½¿ã„ãŸã„æ™‚ä¾¿åˆ©ã«ãªã‚Šã¾ã™ã€‚

```ts

const swrConfig = {
    // åˆå›ã®fetchã®ã¿è¡Œã„ã€ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¿”ã™option
    Immutable: {
        revalidateIfStale: false,
        revalidateOnFocus: false,
        revalidateOnReconnect: false,
    },
};

// ã€œã€œã€œçœç•¥ã€œã€œã€œ
    const { data, error, isLoading } = useSWR<Profile>(
        url,
        swrFetcher,
        swrConfig.Immutable
    );
// ã€œã€œã€œçœç•¥ã€œã€œã€œ
```

ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ãŠã‘ã°ã©ã†ã„ã£ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã®ã‹ä¸€ç¥ã—ãŸã ã‘ã§ã‚ã‹ã‚Šã¾ã™ã—ã€ã“ã†ã™ã‚‹ã“ã¨ã§å†åˆ©ç”¨ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

:::note info
å¤§å¤‰ãŸã‚ã«ãªã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã„ãŸã®ã§ã€ä»¥ä¸‹ãã®å†…å®¹ã‚’è¿½è¨˜ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
:::

ã“ã“ã¾ã§ã®å†…å®¹ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®çŠ¶æ…‹ã§ã™ã€‚

```ts
const swrFetcher = async (url: string) => {
    const headers = {
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`,
    };

    const response = await axios.get(url, { headers });
    return response.data;
};

const useProfile = () => {
    const url = `${API_URL}/profile`;

    const { data, error, isLoading } = useSWR<Profile>(
        url,
        swrFetcher,
        swrConfig.Immutable
    );

    return { data, error, isLoading };
};
```
ã“ã“ã‹ã‚‰æ›´ã«ã‚³ãƒ¼ãƒ‰é‡ã‚’æ¸›ã‚‰ã—ã€æ¥½ã«å…±é€šåŒ–ã§ãã¾ã™ã€‚

axiosã®æ©Ÿèƒ½ã«`create`ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Š`baseURL`ã‚„`headers`ã‚’å¤‰æ›´ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚’é©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts
const instance = axios.create({
  baseURL: 'http://localhost:3003/api', // å…ˆç¨‹ã¾ã§ã®API_URLã«ã‚ãŸã‚‹éƒ¨åˆ†
  headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`,
    },
});

const swrFetcher = async (url: string) => {
    const response = await instance.get(url); // ä¸Šã§ä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
    return response.data;
};

const useProfile = () => {
    const url = "profile";

    const { data, error, isLoading } = useSWR<Profile>(
        url,
        swrFetcher,
        swrConfig.Immutable
    );

    return { data, error, isLoading };
};
```

ã‚­ãƒ¼ã«ã‚‚ä½¿ç”¨ã—ã¦ã„ã‚‹urlãŒã‹ãªã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã€`swrFetcher`ã‚‚äºŒè¡Œã§æ¸ˆã‚€ã‚‚ã®ã«ãªã‚Šã¾ã—ãŸã€‚

åŒã˜ãaxiosã®ã€`interceptors`æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã§åŒã˜ã‚ˆã†ãªçœç•¥ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã‚‰ã¯å€‹äººã®å¥½ã¿ã‚„ã€ã‚„ã‚ŠãŸã„ã“ã¨ã«å¯¾ã—ã¦ã©ã‚Œã ã‘åˆã£ã¦ã„ã‚‹ã‹ã§é¸ã¶æ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚

https://axios-http.com/ja/docs/interceptors

## ãŠã‚ã‚Šã«
å…±é€šåŒ–ã§ãã‚‹éƒ¨åˆ†ã¯ã©ã‚“ã©ã‚“åˆ‡ã‚Šå‡ºã—ã¦ã„ãã¨ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã‚„ã™ããªã£ã¦è‰¯ã„ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ğŸ¤—
SWRã«ã¤ã„ã¦ã€ã¾ãŸã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆæ˜¯éã¨ã‚‚ãŠé¡˜ã„ã—ã¾ã™ğŸ™‡ğŸ»â€â™‚ï¸

ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

---
title: >-
  Laravel Sanctumã®SPAèªè¨¼ Ã— Next.js(React) Axios ã§ 'Request failed with status
  code 419', ã‚¨ãƒ©ãƒ¼è§£æ±º
tags:
  - error
  - Laravel
  - React
  - axios
  - Next.js
private: false
updated_at: '2024-05-12T17:48:54+09:00'
id: da055860df931c30820b
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«

ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€Laravel Sanctumã®SPAèªè¨¼ã‚’Next.jsã§ã‚„ã‚ã†ã¨ã—ãŸæ™‚ã«ãƒãƒã£ãŸéƒ¨åˆ†ã®è§£æ±ºæ³•ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦æ›¸ã„ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚

## ç’°å¢ƒ
- Laravel 9.52.16
- Next.js 14.2.3
- React   ^18
- Axios   ^1.6.8

### ä»Šå›ã®æ–¹æ³•ã§è§£æ±ºã™ã‚‹ã§ã‚ã‚ã†çŠ¶æ³

Laravelã®SPAèªè¨¼ã¯æ­£å¸¸ã«ã§ãã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
ãã®ä¸Šã€CORSã®è¨­å®šã¯ã§ãã¦ã„ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚„Postmanã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸæ™‚ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã§`X-XSRF-TOKEN`ãŒã‚ã‚‹ã€‚

ã“ã®æ¡ä»¶ä¸‹ã§ã€ãã‚Œã§ã‚‚axiosã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸæ™‚ã«`Request failed with status code 419`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã€ä»Šå›ã®è¨˜äº‹ãŒå½¹ã«ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ãã‚Œã¨ã¯åˆ¥ã§ã€ãƒãƒã£ã¦ã„ãŸæ™‚ã«è¦‹ã¦å›ã£ãŸã‚µã‚¤ãƒˆã®URLã‚’æœ€å¾Œã«è²¼ã£ã¦ãŠãã®ã§ã€ã“ã®è¨˜äº‹ã§è§£æ±ºã—ãªãã¨ã‚‚ãã¡ã‚‰ã®è¨˜äº‹ã‚’è¦‹ã‚Œã°è§£æ±ºã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## è§£æ±ºæ³•

#### 1 `axios.defaults.withCredentials`ã‚’è¨­å®šã™ã‚‹ã€‚

:::note alert
<font color="Red">**ğŸš¨`axios.create`ã§`withCredentials: true`ã‚’æŒ‡å®šã—ã¦ã‚‚å‹•ãã¾ã›ã‚“ã€‚ğŸš¨**</font>
:::

**å¿…ãšã€`axios.defaults.withCredentials`**ã€€ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

ä¾‹
```ts
    axios.defaults.withCredentials = true;
    await axios.get(url)...
```

#### 2 `withXSRFToken: true`ãŠã‚ˆã³`xsrfHeaderName: "X-XSRF-TOKEN"`ã‚’è¨­å®šã™ã‚‹
ã“ã¡ã‚‰ã¯`axios.create`å†…ã«è¨˜è¿°ã—ã¦ã‚‚OKã§ã™ã€‚(å°‘ãªãã¨ã‚‚ç§ã®ç’°å¢ƒã§ã¯å¤§ä¸ˆå¤«ã§ã—ãŸ)

ä¾‹
```ts
export const api = axios.create({
    baseURL: API_URL,
    withXSRFToken: true, // è¿½è¨˜
    xsrfHeaderName: "X-XSRF-TOKEN", // è¿½è¨˜
    headers: {
        "Content-Type": "application/json",
    },
});
```


## ãŠã‚ã‚Šã«
ã“ã®2ã¤ã®å¯¾å‡¦æ³•ã‚’è¦‹ã¤ã‘ã‚‹ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸğŸ¥²
ç‰¹ã«`withCredentials`ã‚’axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«è¨˜è¿°ã—ã¦ã‚‚æ©Ÿèƒ½ã—ãªã„ã®ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒã«ãƒãƒã‚Šã¾ã—ãŸ...
ã“ã®è¨˜äº‹ãŒå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ï¼

### ã‚‚ã—ã‹ã—ãŸã‚‰å½¹ã«ç«‹ã¤ã‹ã‚‚ã—ã‚Œãªã„ãƒªãƒ³ã‚¯é›†

https://stackoverflow.com/questions/69002516/axios-not-sending-xsrf-token-with-headers

https://zenn.dev/yudai64/articles/7caaa3c828b828

https://github.com/axios/axios/issues/587

https://laratech.jp/posts/laravel-419-error/

https://stackoverflow.com/questions/72370540/laravel-sanctum-api-httponly-cookie-has-been-rejected-for-invalid-domain

https://blog.sat.ne.jp/2022/09/09/spa-cors-cookie/

https://teratail.com/questions/smpmo3bbcee51z

https://stackoverflow.com/questions/71886290/laravel-9-cors-is-not-working-access-to-xmlhttprequest-has-been-blocked-by-co

